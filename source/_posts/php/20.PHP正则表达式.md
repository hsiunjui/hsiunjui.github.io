---
title: PHP正则表达式
date: 2020-03-16 19:51:26
tags: php高级
categories: PHP
---
>PHP正则表达式的定义及使用。

<!--more-->
# 正则表达式的含义
正则表达式时一种具有**特定模式**的用来**匹配文本**的**字符串**.
```php
$pattern = '/php/'; // 定义匹配规则
$str = "php";
preg_match($pattern, $str, $matches); // 将正则表达式与文本进行匹配返回1/0
```

# 原子
正则表达式中不可再拆分的基本单元(原则能否在分,取决于需求).
- 可见原子
  * 字母
  * 数字
  * 汉字(建议使用unicode编码匹配,[\u4e00-\u9fa5])
  * 符号
  * 空格(\s,因为输入空格可以匹配)
  * 特殊字符(/ \ . * ? " ' | [] () {}),需要转义
- 不可见原子(常用)
  * \t 制表符
  * \n 换行回车符  

# 自定义原子
|原子   | 含义                       |
|-------| -------------------        |
|[abc]  | 只匹配其中一个             |
|[^abc] | 除了其中字符的任意一个     |
|[0-9]  | 匹配一个数字               |
|[a-z]  | 匹配一个小写字母           |
|[A-Z]  | 匹配一个大写字母           |
|\d     | 匹配一个数字,\D取反        |
|\w     | 匹配一数字字母下划线,\W取反|
|\s     | 匹配一个空白字符,\S取反    |

# 元字符
那些在正则表达式中具有特殊意义的专用字符.
|字符   | 含义                           |
|-------| -------------------            |
|.      | 匹配除**换行符**的一个任意字符 |
||      | 匹配多个分支选择(或, com|net)  |
|^      | 匹配一行开始                   |
|$      | 匹配一行结尾                   |
|\b     | 匹配单词边界,\B取反(\bhi\b)    |
|*      | >=0,重复0次或多次              |
|+      | >0, 重复一次或多次             |
|?      | =0||=1,重复0次或一次           |
|{n}    | =n;重复n次                     |
|{n,}   | >=n,重复n次或更多              |
|{n,m}  | >=n&&<=m,重复n次到m次          |
|?      | 0|1,重复0次或一次              |

# 禁止贪婪
```php
$pattern = '/test.*123/'; // 会整段匹配test.*()123123
$str = "test.*()123123";
```
- ?当该字符紧跟在任何一个其他限制符(*,+,{n,},{n,m})后面时,匹配模式时非贪婪的(默认是贪婪的)
  ```php
  $pattern = '/test.*?123/';// 加?,只匹配test.*()123,
  ```
- U,模式修正符(如果结合?模式,会出现负负得正的情况)

# 模式单元
- 用()表示
  ```php
  $pattern = '/(www|code|bbs)\.test\.com/';
  // 可以匹配www.test.com / code.test.com / bbs.test.com
  ```
- 作用
  * 分组
  * 限制多选结构
  * 捕获文本  

# 反向引用
对模式单元中捕获的文本内容的引用。
```php
$pattern = '/([\u4e00-\u9fa5])\1/'; // 捕获中文重叠的字
// 13811223311,13811223322,13811223333,
$pattern2 = '/138(\d{2})(\d{2})(\d{2})\2/'; // \2这个2表示的是第二个括号
```
- 捕获文本放在临时缓冲区中,缓冲区编号1-99,反向引用格式\+编号
- 非捕获元字符?:
  ```php
  $pattern2 = '/138(?:\d{2})(\d{2})(\d{2})\2/'; // 忽略第一个(),从第二个开始,该表达式会匹配到13811223333
  ```

# 定界符
- 当使用正则函数的时候, 模式需要由定界符闭合包裹.(如'/xxx/').
- 分隔符可以是任意非字母数字、非反斜杠(\\),非空白字符.
- 经常使用正斜杠(/),hash符号(#),取反符号(~).
- 如果分隔符需要在模式内匹配,必须使用反斜杠来转义。

# 模式修正符
模式修正符是在最后一个定界符之后的。

| 符号   | 含义                               |
|--------|---------------------               |
|U       |禁止贪婪                            |
|i       |不区分大小写                        |
|x       |忽略**模式中**的空白                |
|s       |将字符串视为单行, . 也能匹配换行     |
|m       |将字符串视为多行,^,$匹配行首行尾     |

# 正则函数
```php
preg_match($pattern, $str, [$matches]); // 搜索文本与给定正则表达式的一个匹配,返回1/0,匹配一个结果
preg_match_all($pattern, $str, [$matches]); // 匹配所有结果,返回匹配的个数
preg_replace($pattern, $replace,$str); // 匹配内容并进行替换,返回处理后的文本
preg_repalce_callback($pattern, $callback,$str); // 指定callback进行替换
preg_filter($pattern, $callback,$str); // 同preg_replace,返回与目标匹配的结果,不符合条件的会被截断
preg_grep($pattern, $arr); // 返回给定数组中与模式匹配的元素组成的数组,第三个参数PREG_GREP_INVERT取反
preg_split($pattern, $str); // 按照给定模式分割字符串,返回数组,第三个参数表示分成多少段
preg_quote($str); // 转义字符中正则表示语法中的特殊字符
```
